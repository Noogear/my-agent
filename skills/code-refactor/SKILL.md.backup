---
name: code-refactor
description: Java code refactoring and cleanup expert. Use for: (1) Review all methods, group by functionality/purpose, create utility classes (2) Eliminate duplicate code, extract common logic, code refactoring (3) Reorganize package structure based on class responsibilities, move classes to appropriate folders (4) Clean up comments, remove inline comments and verbose descriptions, keep only essential checkstyle-required comments and summaries, supplement javadoc. Trigger words: refactor, clean code, organize code, group methods, extract utility, clean comments, simplify code, code optimization, package restructure, move class, reorganize, eliminate duplication, DRY principle.
---

# Code Refactor - Refactoring & Cleanup

## ğŸ”„ é‡æ„æµç¨‹ï¼šå…ˆç”Ÿæˆæ¸…å•ï¼Œåæ‰§è¡Œ

**CRITICAL**: æ”¶åˆ°é‡æ„è¯·æ±‚åï¼Œå¿…é¡»å…ˆæ‰§è¡Œä»¥ä¸‹æ­¥éª¤ï¼š

### Step 1: ä»£ç åˆ†æä¸æ¸…å•ç”Ÿæˆ

è‡ªåŠ¨åˆ†æç›®æ ‡ä»£ç å¹¶ç”Ÿæˆ**å¯äº¤äº’é‡æ„æ¸…å•**ï¼Œæ ¼å¼å¦‚ä¸‹ï¼š

````markdown
# ğŸ“‹ é‡æ„æ¸…å• - [æ–‡ä»¶/æ¨¡å—åç§°]

> è¯·å‹¾é€‰æ‚¨å¸Œæœ›æ‰§è¡Œçš„é‡æ„é¡¹ã€‚å–æ¶ˆå‹¾é€‰ï¼ˆåˆ é™¤âœ“ï¼‰è¡¨ç¤ºè·³è¿‡è¯¥é¡¹ã€‚
> æ‚¨ä¹Ÿå¯ä»¥ä¿®æ”¹æè¿°æˆ–æ·»åŠ å¤‡æ³¨ã€‚å®Œæˆåå›å¤ "ç¡®è®¤æ‰§è¡Œ" æˆ– "å…¨éƒ¨æ‰§è¡Œ"ã€‚

## ğŸ¯ æ€»è§ˆç»Ÿè®¡
- æ€»æ–‡ä»¶æ•°: X ä¸ª
- æ€»é‡æ„é¡¹: Y ä¸ª
- é¢„ä¼°é£é™©ç­‰çº§: [ä½/ä¸­/é«˜]
- é¢„ä¼°è€—æ—¶: ~Z åˆ†é’Ÿ

---

## ğŸ“‚ ä¸€ã€ä»£ç åå‘³é“ä¿®å¤ï¼ˆä¼˜å…ˆçº§ï¼šé«˜ï¼‰

### 1.1 é•¿æ–¹æ³•é‡æ„
- [ ] **æ–¹æ³•**: `ClassName.longMethodName()` (ç¬¬ 123 è¡Œ)
  - å½“å‰è¡Œæ•°: 45 è¡Œ
  - åµŒå¥—å±‚çº§: 4 å±‚
  - å»ºè®®æ“ä½œ: æ‹†åˆ†ä¸º 3 ä¸ªå­æ–¹æ³•
  - é£é™©ç­‰çº§: ä¸­
  - é¢„ä¼°æ”¹åŠ¨: ~15 è¡Œä»£ç 

- [ ] **æ–¹æ³•**: `ClassName.anotherLongMethod()` (ç¬¬ 234 è¡Œ)
  - å½“å‰è¡Œæ•°: 38 è¡Œ
  - åµŒå¥—å±‚çº§: 3 å±‚
  - å»ºè®®æ“ä½œ: æå–å¾ªç¯é€»è¾‘åˆ°ç‹¬ç«‹æ–¹æ³•
  - é£é™©ç­‰çº§: ä½
  - é¢„ä¼°æ”¹åŠ¨: ~10 è¡Œä»£ç 

### 1.2 å¤§ç±»æ‹†åˆ†
- [ ] **ç±»**: `LargeClass` (456 è¡Œ)
  - å…¬å…±æ–¹æ³•æ•°: 15 ä¸ª
  - èŒè´£åˆ†æ: æ··åˆäº†é…ç½®ç®¡ç†ã€æ•°æ®éªŒè¯ã€æ—¥å¿—è®°å½•
  - å»ºè®®æ“ä½œ: æ‹†åˆ†ä¸º `ConfigManager`ã€`DataValidator`ã€`Logger` ä¸‰ä¸ªç±»
  - é£é™©ç­‰çº§: é«˜
  - é¢„ä¼°æ”¹åŠ¨: åˆ›å»º 3 ä¸ªæ–°ç±»ï¼Œç§»åŠ¨ 200+ è¡Œä»£ç 

### 1.3 é‡å¤ä»£ç æ¶ˆé™¤
- [ ] **é‡å¤æ¨¡å¼ 1**: å­—ç¬¦ä¸²è§„èŒƒåŒ–é€»è¾‘ï¼ˆå‡ºç° 5 æ¬¡ï¼‰
  - ä½ç½®: L45, L89, L123, L234, L456
  - é‡å¤ä»£ç :
    ```java
    String normalized = input.toLowerCase().trim();
    if (normalized.isEmpty()) return defaultValue;
    ```
  - å»ºè®®æ“ä½œ: æå–åˆ° `StringUtils.normalizeOrDefault()`
  - é£é™©ç­‰çº§: ä½
  - é¢„ä¼°æ”¹åŠ¨: æ–°å¢ 1 ä¸ªå·¥å…·æ–¹æ³•ï¼Œæ›¿æ¢ 5 å¤„è°ƒç”¨

- [ ] **é‡å¤æ¨¡å¼ 2**: ç©ºå€¼æ£€æŸ¥é€»è¾‘ï¼ˆå‡ºç° 8 æ¬¡ï¼‰
  - ä½ç½®: L34, L67, L99, L145, L189, L234, L289, L345
  - é‡å¤ä»£ç :
    ```java
    if (obj == null || obj.isEmpty() || !obj.isValid()) {
        throw new IllegalArgumentException("Invalid");
    }
    ```
  - å»ºè®®æ“ä½œ: æå–åˆ° `Preconditions.requireValid()`
  - é£é™©ç­‰çº§: ä½
  - é¢„ä¼°æ”¹åŠ¨: æ–°å¢ 1 ä¸ªéªŒè¯æ–¹æ³•ï¼Œæ›¿æ¢ 8 å¤„è°ƒç”¨

### 1.4 ç‰¹æ€§å¦’å¿Œï¼ˆFeature Envyï¼‰
- [ ] **æ–¹æ³•**: `ClassA.processUser()` ä½¿ç”¨ `User` ç±»çš„ 8 ä¸ªæ–¹æ³•
  - å½“å‰ä½ç½®: ClassA.java:45
  - å»ºè®®æ“ä½œ: ç§»åŠ¨åˆ° `User` ç±»ä½œä¸ºå®ä¾‹æ–¹æ³•
  - é£é™©ç­‰çº§: ä¸­
  - é¢„ä¼°æ”¹åŠ¨: ç§»åŠ¨ 20 è¡Œä»£ç ï¼Œæ›´æ–° 3 å¤„è°ƒç”¨

### 1.5 æ•°æ®æ³¥å›¢ï¼ˆData Clumpï¼‰
- [ ] **å‚æ•°ç»„ 1**: `startDate, endDate, format` å…±åŒå‡ºç° 6 æ¬¡
  - æ¶‰åŠæ–¹æ³•: `formatDate()`, `validateDate()`, `parseDate()`, ç­‰
  - å»ºè®®æ“ä½œ: åˆ›å»º `DateRange` record ç±»
  - é£é™©ç­‰çº§: ä¸­
  - é¢„ä¼°æ”¹åŠ¨: æ–°å¢ 1 ä¸ª recordï¼Œä¿®æ”¹ 6 ä¸ªæ–¹æ³•ç­¾å

---

## ğŸ§© äºŒã€æ–¹æ³•ç»„ç»‡ä¸å·¥å…·ç±»æå–ï¼ˆä¼˜å…ˆçº§ï¼šä¸­ï¼‰

### 2.1 é™æ€å·¥å…·æ–¹æ³•æå–

#### 2.1.1 å­—ç¬¦ä¸²å¤„ç†
- [ ] **æå–åˆ°**: `util/StringUtils.java` (æ–°å»º)
  - æ–¹æ³•åˆ—è¡¨:
    - [ ] `normalize(String)` - ä» 3 å¤„æå–
    - [ ] `isValidLength(String, int)` - ä» 2 å¤„æå–
    - [ ] `sanitize(String)` - ä» 4 å¤„æå–
  - é£é™©ç­‰çº§: ä½
  - é¢„ä¼°æ”¹åŠ¨: æ–°å»ºç±»ï¼Œç§»åŠ¨ 30 è¡Œä»£ç 

#### 2.1.2 é›†åˆæ“ä½œ
- [ ] **æå–åˆ°**: `util/CollectionUtils.java` (æ–°å»º)
  - æ–¹æ³•åˆ—è¡¨:
    - [ ] `filterNulls(List<T>)` - ä» 5 å¤„æå–
    - [ ] `partition(List<T>, int)` - ä» 2 å¤„æå–
    - [ ] `findDuplicates(List<T>)` - ä» 3 å¤„æå–
  - é£é™©ç­‰çº§: ä½
  - é¢„ä¼°æ”¹åŠ¨: æ–°å»ºç±»ï¼Œç§»åŠ¨ 45 è¡Œä»£ç 

#### 2.1.3 åå°„æ“ä½œ
- [ ] **æå–åˆ°**: `util/ReflectionUtils.java` (æ–°å»º)
  - æ–¹æ³•åˆ—è¡¨:
    - [ ] `getFieldValue(Object, String)` - ä» 4 å¤„æå–
    - [ ] `setAccessible(Field)` - ä» 6 å¤„æå–
    - [ ] `findAnnotation(Class, Class<A>)` - ä» 3 å¤„æå–
  - é£é™©ç­‰çº§: ä½
  - é¢„ä¼°æ”¹åŠ¨: æ–°å»ºç±»ï¼Œç§»åŠ¨ 50 è¡Œä»£ç 

### 2.2 æ–¹æ³•åˆ†ç»„é‡ç»„
- [ ] **ç±»**: `ConfigManager` - æŒ‰èŒè´£é‡æ–°åˆ†ç»„
  - å½“å‰: æ–¹æ³•é¡ºåºæ··ä¹±
  - å»ºè®®åˆ†ç»„:
    1. ç”Ÿå‘½å‘¨æœŸæ–¹æ³• (load, save, reload)
    2. éªŒè¯æ–¹æ³• (validate, check)
    3. è®¿é—®å™¨æ–¹æ³• (getters)
  - é£é™©ç­‰çº§: ä½
  - é¢„ä¼°æ”¹åŠ¨: è°ƒæ•´æ–¹æ³•é¡ºåºï¼Œæ·»åŠ åˆ†ç»„æ³¨é‡Š

---

## ğŸ“¦ ä¸‰ã€åŒ…ç»“æ„é‡ç»„ï¼ˆä¼˜å…ˆçº§ï¼šä¸­ï¼‰

### 3.1 æ³¨è§£ç§»åŠ¨
- [ ] **æ–‡ä»¶**: `@Template` æ³¨è§£
  - å½“å‰: `src/main/java/gloomlib/config/Template.java`
  - ç›®æ ‡: `src/main/java/gloomlib/annotation/Template.java`
  - åŸå› : æ³¨è§£åº”ç»Ÿä¸€æ”¾åœ¨ annotation åŒ…
  - é£é™©ç­‰çº§: ä½
  - é¢„ä¼°æ”¹åŠ¨: ç§»åŠ¨ 1 ä¸ªæ–‡ä»¶ï¼Œæ›´æ–° import

### 3.2 å¼‚å¸¸ç±»ç§»åŠ¨
- [ ] **æ–‡ä»¶**: `ConfigurationException`
  - å½“å‰: `src/main/java/gloomlib/config/ConfigurationException.java`
  - ç›®æ ‡: `src/main/java/gloomlib/exception/ConfigurationException.java`
  - åŸå› : å¼‚å¸¸åº”ç»Ÿä¸€æ”¾åœ¨ exception åŒ…
  - é£é™©ç­‰çº§: ä½
  - é¢„ä¼°æ”¹åŠ¨: ç§»åŠ¨ 1 ä¸ªæ–‡ä»¶ï¼Œæ›´æ–° 5 å¤„ import

### 3.3 å·¥å…·ç±»ç§»åŠ¨
- [ ] **æ–‡ä»¶**: `StringHelper`
  - å½“å‰: `src/main/java/gloomlib/config/StringHelper.java`
  - ç›®æ ‡: `src/main/java/gloomlib/util/StringUtils.java`
  - åŸå› : å·¥å…·ç±»åº”æ”¾åœ¨ util åŒ…ï¼Œä¸”é‡å‘½åä¸º *Utils
  - é£é™©ç­‰çº§: ä½
  - é¢„ä¼°æ”¹åŠ¨: ç§»åŠ¨ 1 ä¸ªæ–‡ä»¶ï¼Œé‡å‘½åï¼Œæ›´æ–° 8 å¤„ import

### 3.4 æ¥å£ä¸å®ç°åˆ†ç¦»
- [ ] **åˆ›å»ºæ¥å£åŒ…**: `api/` (æ–°å»º)
  - ç§»åŠ¨æ¥å£:
    - [ ] `Translator` â†’ `api/Translator.java`
    - [ ] `ConfigLoader` â†’ `api/ConfigLoader.java`
  - é£é™©ç­‰çº§: ä½
  - é¢„ä¼°æ”¹åŠ¨: ç§»åŠ¨ 2 ä¸ªæ¥å£ï¼Œæ›´æ–° import

- [ ] **åˆ›å»ºå®ç°åŒ…**: `impl/` (æ–°å»º)
  - ç§»åŠ¨å®ç°ç±»:
    - [ ] `TranslatorImpl` â†’ `impl/TranslatorImpl.java`
    - [ ] `ConfigLoaderImpl` â†’ `impl/ConfigLoaderImpl.java`
  - é£é™©ç­‰çº§: ä½
  - é¢„ä¼°æ”¹åŠ¨: ç§»åŠ¨ 2 ä¸ªç±»ï¼Œæ›´æ–° import

---

## ğŸ“ å››ã€æ³¨é‡Šä¸æ–‡æ¡£ä¼˜åŒ–ï¼ˆä¼˜å…ˆçº§ï¼šä½ï¼‰

### 4.1 æ¸…ç†å†—ä½™æ³¨é‡Š
- [ ] **åˆ é™¤æ— ç”¨æ³¨é‡Š** (å…± 23 å¤„)
  - ç±»å‹æ˜ç»†:
    - [ ] è‡ªåŠ¨ç”Ÿæˆçš„ä½œè€…æ ‡ç­¾ (@author) - 12 å¤„
    - [ ] ç‰ˆæœ¬æ ‡ç­¾ (@version) - 8 å¤„
    - [ ] åºŸå¼ƒçš„ since æ ‡ç­¾ (@since) - 3 å¤„
  - é£é™©ç­‰çº§: ä½
  - é¢„ä¼°æ”¹åŠ¨: åˆ é™¤ 23 è¡Œæ³¨é‡Š

### 4.2 ç®€åŒ– JavaDoc
- [ ] **ç±»æ–‡æ¡£ç®€åŒ–** (å…± 15 ä¸ªç±»)
  - ç¤ºä¾‹:
    - å½“å‰: "This class is responsible for managing translation..." (3 è¡Œ)
    - ä¼˜åŒ–: "Translation manager implementation." (1 è¡Œ)
  - é£é™©ç­‰çº§: ä½
  - é¢„ä¼°æ”¹åŠ¨: ç²¾ç®€ 45 è¡Œæ–‡æ¡£

- [ ] **æ–¹æ³•æ–‡æ¡£ç®€åŒ–** (å…± 34 ä¸ªæ–¹æ³•)
  - åˆ é™¤æ˜¾è€Œæ˜“è§çš„ getter/setter æ–‡æ¡£
  - ä¿ç•™å¤æ‚é€»è¾‘çš„æ–‡æ¡£
  - é£é™©ç­‰çº§: ä½
  - é¢„ä¼°æ”¹åŠ¨: åˆ é™¤ 20 è¡Œï¼Œç²¾ç®€ 14 è¡Œ

### 4.3 è¡¥å……ç¼ºå¤±æ–‡æ¡£
- [ ] **æ·»åŠ ç±»æ–‡æ¡£** (å…± 5 ä¸ªç±»ç¼ºå¤±)
  - `StringUtils`, `ReflectionHelper`, ç­‰
  - é£é™©ç­‰çº§: ä½
  - é¢„ä¼°æ”¹åŠ¨: æ–°å¢ 5 ä¸ªç±»æ–‡æ¡£æ³¨é‡Š

- [ ] **æ·»åŠ å…¬å…±æ–¹æ³•æ–‡æ¡£** (å…± 8 ä¸ªæ–¹æ³•ç¼ºå¤±)
  - å…¬å…± API å¿…é¡»æœ‰æ–‡æ¡£
  - é£é™©ç­‰çº§: ä½
  - é¢„ä¼°æ”¹åŠ¨: æ–°å¢ 8 ä¸ªæ–¹æ³•æ–‡æ¡£æ³¨é‡Š

---

## ğŸ”§ äº”ã€ä»£ç ä¹ æƒ¯ä¼˜åŒ–ï¼ˆä¼˜å…ˆçº§ï¼šä½ï¼‰

### 5.1 é­”æ³•æ•°å­—æå–
- [ ] **å¸¸é‡åŒ–é­”æ³•æ•°å­—** (å…± 12 å¤„)
  - ç¤ºä¾‹:
    - `List<String> list = new ArrayList<>(16);` â†’ `DEFAULT_LIST_CAPACITY`
    - `Thread.sleep(5000);` â†’ `RETRY_DELAY_MS`
  - é£é™©ç­‰çº§: ä½
  - é¢„ä¼°æ”¹åŠ¨: æ–°å¢ 12 ä¸ªå¸¸é‡ï¼Œæ›¿æ¢ 12 å¤„ä½¿ç”¨

### 5.2 åæ¨¡å¼ä¿®å¤
- [ ] `if (x) return true; else return false;` â†’ `return x;` (3 å¤„)
- [ ] `if (x == true)` â†’ `if (x)` (5 å¤„)
- [ ] `str.equals("")` â†’ `str.isEmpty()` (7 å¤„)
- [ ] `list.size() == 0` â†’ `list.isEmpty()` (4 å¤„)
- [ ] `new Integer(x)` â†’ `Integer.valueOf(x)` (2 å¤„)
  - é£é™©ç­‰çº§: ä½
  - é¢„ä¼°æ”¹åŠ¨: ä¿®æ”¹ 21 è¡Œä»£ç 

### 5.3 Java ç°ä»£åŒ–
- [ ] **ä½¿ç”¨ var å…³é”®å­—** (é€‚ç”¨ 15 å¤„)
  - `String name = "test";` â†’ `var name = "test";`
  - é£é™©ç­‰çº§: ä½
  - é¢„ä¼°æ”¹åŠ¨: ç®€åŒ– 15 è¡Œä»£ç 

- [ ] **ä½¿ç”¨ Text Blocks** (é€‚ç”¨ 3 å¤„)
  - å¤šè¡Œå­—ç¬¦ä¸²æ‹¼æ¥ â†’ Java 15+ text blocks
  - é£é™©ç­‰çº§: ä½
  - é¢„ä¼°æ”¹åŠ¨: ç®€åŒ– 3 å¤„å­—ç¬¦ä¸²å®šä¹‰

- [ ] **ä½¿ç”¨ Record ç±»** (é€‚ç”¨ 2 ä¸ª DTO)
  - `UserDTO` POJO â†’ record
  - `ConfigData` POJO â†’ record
  - é£é™©ç­‰çº§: ä½
  - é¢„ä¼°æ”¹åŠ¨: ç®€åŒ– 40 è¡Œä»£ç 

### 5.4 å¼‚å¸¸å¤„ç†æ”¹è¿›
- [ ] **ç§»é™¤ç©º catch å—** (2 å¤„)
  - æ·»åŠ æ—¥å¿—æˆ–é‡æ–°æŠ›å‡º
  - é£é™©ç­‰çº§: ä¸­
  - é¢„ä¼°æ”¹åŠ¨: æ·»åŠ å¼‚å¸¸å¤„ç†é€»è¾‘

---

## ğŸ“Š å…­ã€æ€§èƒ½ä¼˜åŒ–ï¼ˆå¯é€‰ï¼Œä¼˜å…ˆçº§ï¼šä½ï¼‰

### 6.1 é›†åˆé¢„åˆ†é…
- [ ] **ArrayList åˆå§‹å®¹é‡** (8 å¤„)
  - å·²çŸ¥å¤§å°æ—¶é¢„åˆ†é…å®¹é‡
  - é£é™©ç­‰çº§: ä½
  - æ€§èƒ½æå‡: å‡å°‘æ‰©å®¹æ“ä½œ

### 6.2 å­—ç¬¦ä¸²æ‹¼æ¥ä¼˜åŒ–
- [ ] **å¾ªç¯ä¸­çš„ String +** (3 å¤„)
  - æ›¿æ¢ä¸º `StringBuilder`
  - é£é™©ç­‰çº§: ä½
  - æ€§èƒ½æå‡: O(nÂ²) â†’ O(n)

### 6.3 æµå¼ API ä¼˜åŒ–
- [ ] **å¹¶è¡Œæµä½¿ç”¨** (2 å¤„)
  - å¤§é›†åˆæ“ä½œå¯ä½¿ç”¨ `parallelStream()`
  - é£é™©ç­‰çº§: ä¸­
  - æ€§èƒ½æå‡: åˆ©ç”¨å¤šæ ¸å¤„ç†

---

## âœ… æ‰§è¡ŒåéªŒè¯æ¸…å•

- [ ] æ‰€æœ‰æµ‹è¯•é€šè¿‡ (`./gradlew test`)
- [ ] ä»£ç é£æ ¼æ£€æŸ¥é€šè¿‡ (`./gradlew checkstyle`)
- [ ] æ— æ–°å¢ç¼–è¯‘è­¦å‘Š
- [ ] æµ‹è¯•è¦†ç›–ç‡æœªé™ä½
- [ ] Git diff å®¡æŸ¥å®Œæˆ

---

**è¯·å®¡æŸ¥ä¸Šè¿°æ¸…å•ï¼Œå‘ŠçŸ¥ï¼š**
1. å–æ¶ˆå‹¾é€‰ä¸éœ€è¦çš„é¡¹ï¼ˆæ ‡è®°ä¸º `- [ ]`ï¼‰
2. ä¿®æ”¹ä»»ä½•æè¿°æˆ–å¤‡æ³¨
3. å›å¤ "ç¡®è®¤æ‰§è¡Œ" å¼€å§‹é‡æ„ï¼Œæˆ– "å…¨éƒ¨æ‰§è¡Œ" æ‰§è¡Œæ‰€æœ‰é¡¹
````

### Step 2: ç­‰å¾…ç”¨æˆ·ç¡®è®¤

**å¿…é¡»ç­‰å¾…ç”¨æˆ·å®¡æŸ¥å¹¶ç¡®è®¤æ¸…å•åï¼Œæ‰èƒ½å¼€å§‹æ‰§è¡Œé‡æ„ã€‚**

ç”¨æˆ·å¯èƒ½çš„å“åº”ï¼š
- âœ… "ç¡®è®¤æ‰§è¡Œ" / "å…¨éƒ¨æ‰§è¡Œ" â†’ å¼€å§‹æ‰§è¡Œå‹¾é€‰çš„é¡¹
- âœï¸ ä¿®æ”¹æ¸…å•ï¼ˆå–æ¶ˆå‹¾é€‰ã€æ·»åŠ å¤‡æ³¨ï¼‰â†’ æ ¹æ®ä¿®æ”¹åçš„æ¸…å•æ‰§è¡Œ
- â­ï¸ "åªæ‰§è¡Œä½é£é™©çš„" â†’ ç­›é€‰ä½é£é™©é¡¹æ‰§è¡Œ
- ğŸ” "å…ˆçœ‹çœ‹ X éƒ¨åˆ†çš„ä»£ç " â†’ å±•ç¤ºç›¸å…³ä»£ç ä¾›å®¡æŸ¥
- âŒ "å–æ¶ˆ" â†’ åœæ­¢é‡æ„æµç¨‹

### Step 3: æŒ‰ä¼˜å…ˆçº§æ‰§è¡Œ

æ ¹æ®ç”¨æˆ·ç¡®è®¤çš„æ¸…å•ï¼ŒæŒ‰ç…§ä»¥ä¸‹é¡ºåºæ‰§è¡Œï¼š

```
1. ä»£ç åå‘³é“ä¿®å¤ï¼ˆä½é£é™©é¡¹ï¼‰
2. å·¥å…·ç±»æå–
3. æ–¹æ³•é‡ç»„
4. æ³¨é‡Šä¼˜åŒ–
5. åŒ…ç»“æ„é‡ç»„ï¼ˆæœ€åæ‰§è¡Œï¼‰
```

æ¯å®Œæˆä¸€ä¸ªå¤§ç±»ï¼Œæä¾›è¿›åº¦æ›´æ–°ï¼š
```
âœ… [1/6] ä»£ç åå‘³é“ä¿®å¤ - å®Œæˆ
   - ä¿®å¤é•¿æ–¹æ³•: 2/2
   - æ¶ˆé™¤é‡å¤: 2/2
   
ğŸ”„ [2/6] å·¥å…·ç±»æå– - è¿›è¡Œä¸­...
```

---

## ğŸ’¡ æ¸…å•ç”Ÿæˆæ™ºèƒ½è§„åˆ™

### è‡ªåŠ¨æ£€æµ‹ä¼˜å…ˆçº§


| æ£€æµ‹é¡¹ | é«˜ä¼˜å…ˆçº§ | ä¸­ä¼˜å…ˆçº§ | ä½ä¼˜å…ˆçº§ |
|--------|----------|----------|----------|
| **é•¿æ–¹æ³•** | >50 è¡Œ | 30-50 è¡Œ | 20-30 è¡Œ |
| **å¤æ‚åº¦** | >15 åœˆå¤æ‚åº¦ | 10-15 | 5-10 |
| **é‡å¤ä»£ç ** | 10+ è¡Œé‡å¤ | 5-10 è¡Œ | 3-5 è¡Œ |
| **å¤§ç±»** | >500 è¡Œ | 300-500 è¡Œ | 200-300 è¡Œ |
| **é•¿å‚æ•°åˆ—è¡¨** | >6 å‚æ•° | 4-6 å‚æ•° | - |

### é£é™©ç­‰çº§åˆ¤å®š

```python
é£é™© = ä½  # é»˜è®¤

if æ”¹åŠ¨æ¶‰åŠå…¬å…±APIç­¾å:
    é£é™© = é«˜
elif æ”¹åŠ¨æ¶‰åŠæ ¸å¿ƒç®—æ³•é€»è¾‘:
    é£é™© = ä¸­
elif æ”¹åŠ¨è¡Œæ•° > 50:
    é£é™© = ä¸­
elif ç¼ºå°‘å•å…ƒæµ‹è¯•è¦†ç›–:
    é£é™© += 1çº§

if æœ‰å®Œæ•´é›†æˆæµ‹è¯•:
    é£é™© -= 1çº§
```

### è‡ªåŠ¨åˆ†ç±»è§„åˆ™

**å·¥å…·ç±»è¯†åˆ«æ¨¡å¼**ï¼š
```regex
ç±»å: .*Utils?|.*Helper|.*Tool
ç‰¹å¾: 
  - æ‰€æœ‰æ–¹æ³•å‡ä¸º public static
  - ç§æœ‰æ„é€ å‡½æ•°
  - æ— å®ä¾‹å­—æ®µ
  - æ— ç»§æ‰¿å…³ç³»
```

**é‡å¤ä»£ç æ¨¡å¼**ï¼š
```
Type 1: å®Œå…¨ç›¸åŒï¼ˆhash åŒ¹é…ï¼‰
Type 2: è¯­ä¹‰ç›¸åŒï¼ˆAST ç»“æ„åŒ¹é…ï¼‰
Type 3: éƒ¨åˆ†ç›¸åŒï¼ˆç¼–è¾‘è·ç¦» < 20%ï¼‰
```

---

## ğŸ“‹ æ¸…å•ç”Ÿæˆæ¨¡æ¿ï¼ˆè‡ªåŠ¨å¡«å……ï¼‰

æ‰§è¡Œåˆ†ææ—¶è‡ªåŠ¨å¡«å……ä»¥ä¸‹æ¸…å•ï¼š

```markdown
## åˆ†æç»“æœæ‘˜è¦
- æ‰«ææ–‡ä»¶: {file_count} ä¸ª
- ä»£ç è¡Œæ•°: {total_lines} è¡Œ
- æ£€æµ‹é—®é¢˜: {issue_count} ä¸ª
- é«˜ä¼˜å…ˆçº§: {high_priority} ä¸ª
- ä¸­ä¼˜å…ˆçº§: {medium_priority} ä¸ª
- ä½ä¼˜å…ˆçº§: {low_priority} ä¸ª
- é¢„ä¼°æ€»è€—æ—¶: {estimated_time} åˆ†é’Ÿ

## é‡æ„ä»·å€¼è¯„ä¼°
- å¯æ¶ˆé™¤é‡å¤ä»£ç : {duplicate_lines} è¡Œ
- å¯æå–å·¥å…·æ–¹æ³•: {util_methods} ä¸ª
- å¯æ”¹è¿›å¯è¯»æ€§: {readability_score_delta} åˆ†
- å¯é™ä½åœˆå¤æ‚åº¦: {complexity_reduction} ç‚¹
```

---

## ğŸ” æ‰§è¡Œæµç¨‹è¯¦è§£

### Phase 1: ä»£ç æ‰«æä¸é—®é¢˜å®šä½

**è‡ªåŠ¨æ‰«ææ¸…å•é¡¹æ£€æµ‹**ï¼š

1. **é•¿æ–¹æ³•æ‰«æ**
   ```java
   // åˆ†ææ–¹æ³•ä½“
   for (Method m : class.getMethods()) {
       int lines = m.getLineCount();
       int complexity = m.getCyclomaticComplexity();
       int nesting = m.getMaxNestingLevel();
       
       if (lines > 30 || complexity > 10 || nesting > 3) {
           clearChecklist.add("é•¿æ–¹æ³•: " + m.getName() + 
               " (è¡Œæ•°:" + lines + ", å¤æ‚åº¦:" + complexity + ")");
       }
   }
   ```

2. **é‡å¤ä»£ç æ£€æµ‹**
   ```java
   // Clone detection
   Map<String, List<Location>> codeBlocks = new HashMap<>();
   
   for (CodeBlock block : allBlocks) {
       String hash = block.computeHash();
       codeBlocks.computeIfAbsent(hash, k -> new ArrayList<>())
                 .add(block.getLocation());
   }
   
   // æ ‡è®°é‡å¤å‡ºç° 2 æ¬¡ä»¥ä¸Šçš„ä»£ç å—
   codeBlocks.entrySet().stream()
       .filter(e -> e.getValue().size() >= 2)
       .forEach(e -> addToChecklist("é‡å¤ä»£ç ", e.getValue()));
   ```

3. **åŒ…ç»“æ„åˆ†æ**
   ```java
   // æ£€æŸ¥ç±»æ˜¯å¦åœ¨æ­£ç¡®çš„åŒ…ä¸­
   for (Class c : allClasses) {
       String expectedPackage = inferPackage(c);
       String actualPackage = c.getPackage();
       
       if (!expectedPackage.equals(actualPackage)) {
           addToChecklist("åŒ…ç»“æ„", 
               "ç§»åŠ¨ " + c.getName() + 
               " ä» " + actualPackage + 
               " åˆ° " + expectedPackage);
       }
   }
   ```

### Phase 2: æ¸…å•äº¤äº’æµç¨‹

```
1. ç”Ÿæˆåˆå§‹æ¸…å• (Markdown æ ¼å¼)
   â†“
2. å±•ç¤ºç»™ç”¨æˆ·ï¼Œç­‰å¾…åé¦ˆ
   â†“
3. ç”¨æˆ·å“åº”åˆ†æ”¯:
   â”œâ”€ "ç¡®è®¤æ‰§è¡Œ" â†’ è§£æå‹¾é€‰é¡¹ â†’ å¼€å§‹æ‰§è¡Œ
   â”œâ”€ "å…¨éƒ¨æ‰§è¡Œ" â†’ å…¨é€‰ â†’ å¼€å§‹æ‰§è¡Œ
   â”œâ”€ "åªæ‰§è¡Œä½é£é™©" â†’ ç­›é€‰é£é™©=ä½ â†’ å¼€å§‹æ‰§è¡Œ
   â”œâ”€ "è·³è¿‡ X éƒ¨åˆ†" â†’ å–æ¶ˆè¯¥åˆ†ç±»å‹¾é€‰ â†’ é‡æ–°å±•ç¤º
   â””â”€ ä¿®æ”¹æ¸…å• â†’ è§£æç”¨æˆ·ä¿®æ”¹ â†’ é‡æ–°å±•ç¤º
   â†“
4. å¼€å§‹æ‰§è¡Œï¼ˆæŒ‰ä¼˜å…ˆçº§æ’åºï¼‰
```

### Phase 3: æ‰§è¡Œä¸è¿›åº¦æŠ¥å‘Š

**æ‰§è¡Œæ—¶å®æ—¶æŠ¥å‘Š**ï¼š

```markdown
## ğŸš€ æ‰§è¡Œè¿›åº¦

### æ€»è¿›åº¦: â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘ 80% (12/15 å·²å®Œæˆ)

---

### âœ… [1/6] ä»£ç åå‘³é“ä¿®å¤ - å·²å®Œæˆ
- âœ… é•¿æ–¹æ³•é‡æ„: 2/2
  - âœ… `UserService.validateUser()` - æ‹†åˆ†ä¸º 3 ä¸ªæ–¹æ³•
  - âœ… `ConfigLoader.loadConfig()` - æå–å¾ªç¯é€»è¾‘
- âœ… é‡å¤ä»£ç æ¶ˆé™¤: 2/2
  - âœ… å­—ç¬¦ä¸²è§„èŒƒåŒ– â†’ `StringUtils.normalize()`
  - âœ… ç©ºå€¼æ£€æŸ¥ â†’ `Preconditions.requireValid()`

### âœ… [2/6] å·¥å…·ç±»æå– - å·²å®Œæˆ
- âœ… `StringUtils.java` åˆ›å»ºå¹¶è¿ç§» 3 ä¸ªæ–¹æ³•
- âœ… `CollectionUtils.java` åˆ›å»ºå¹¶è¿ç§» 3 ä¸ªæ–¹æ³•

### ğŸ”„ [3/6] åŒ…ç»“æ„é‡ç»„ - è¿›è¡Œä¸­ (1/3)
- âœ… ç§»åŠ¨ `@Template` â†’ `annotation/`
- â³ ç§»åŠ¨ `ConfigException` â†’ `exception/` ...
- â¸ï¸ ç§»åŠ¨ `StringHelper` â†’ `util/` (å¾…æ‰§è¡Œ)

### â¸ï¸ [4/6] æ³¨é‡Šä¼˜åŒ– - å¾…æ‰§è¡Œ
### â¸ï¸ [5/6] ä»£ç ä¹ æƒ¯ä¼˜åŒ– - å¾…æ‰§è¡Œ
### â¸ï¸ [6/6] æ€§èƒ½ä¼˜åŒ– - å¾…æ‰§è¡Œ

---

**é¢„ä¼°å‰©ä½™æ—¶é—´**: ~5 åˆ†é’Ÿ
```

---

## ğŸ“– å®Œæ•´é‡æ„æŒ‡å—ï¼ˆåŸå†…å®¹ä¿ç•™ï¼‰

### ä»£ç åå‘³é“æ£€æµ‹è¡¨

| Smell | Detection Pattern | Severity |
|-------|-------------------|----------|
| **Long Method** | >30 lines or >3 levels of nesting | High |
| **Large Class** | >300 lines or >10 public methods | High |
| **Duplicate Code** | 3+ identical lines appearing 2+ times | High |
| **Feature Envy** | Method uses another class's data more than its own | Medium |
| **Data Clump** | Same 3+ params appear together repeatedly | Medium |
| **Primitive Obsession** | Using primitives instead of small objects | Medium |
| **Long Parameter List** | >4 parameters | Medium |
| **Dead Code** | Unreachable/unused code | Low |
| **Speculative Generality** | Unused abstractions "for future use" | Low |

Quick wins (fix first):
- Unused imports â†’ Delete
- Unused private methods â†’ Delete  
- Unused variables â†’ Delete
- Magic numbers â†’ Extract to constants


### æ–¹æ³•åˆ†ç»„ç­–ç•¥

Group methods by the following dimensions:

| Category | Examples | Target Class |
|----------|----------|--------------|
| IO Operations | File read/write, stream processing | `FileUtils` / `IOUtils` |
| String Processing | Parsing, formatting, validation | `StringUtils` / `TextUtils` |
| Collection Operations | Filtering, transformation, aggregation | `CollectionUtils` |
| Reflection Utilities | Field access, type checking | `ReflectionUtils` |
| Validation Logic | Null checks, range checks, format checks | `Preconditions` / `Validators` |
| Conversion Logic | Type casting, DTO mapping | `Converters` |
| Date/Time | Formatting, parsing, calculations | `TimeUtils` |

Decision tree:
```
Is method stateless (no instance fields used)?
â”œâ”€ Yes â†’ Candidate for utility class
â”‚   â””â”€ Used by 2+ classes? â†’ Extract to shared util
â”‚   â””â”€ Used by 1 class only? â†’ Keep as private static
â””â”€ No â†’ Keep as instance method
    â””â”€ Used by child classes? â†’ Consider protected
```


### é‡å¤ä»£ç æ¶ˆé™¤ç­–ç•¥

#### Detection Patterns

```java
// Type 1: Exact Clone - identical code
// Action: Extract Method immediately

// Type 2: Renamed Clone - same structure, different names
void processUser(User u) { validate(u); save(u); log(u); }
void processOrder(Order o) { validate(o); save(o); log(o); }
// Action: Extract generic method with type parameter

// Type 3: Near Clone - minor differences
if (user != null && user.isActive()) { ... }
if (order != null && order.isValid()) { ... }
// Action: Extract with functional parameter

// Type 4: Semantic Clone - different code, same purpose
// Action: Keep one, delete others
```

#### Refactoring Techniques

| Technique | When to Use | Example |
|-----------|-------------|---------|
| Extract Method | Same class, 3+ duplicate lines | `calculateTotal()` |
| Extract Superclass | Related classes share behavior | `AbstractProcessor` |
| Extract Interface | Need polymorphism | `Validatable` |
| Template Method | Same algorithm, different steps | `process()` + `doProcess()` |
| Strategy Pattern | Interchangeable algorithms | `SortStrategy` |
| Introduce Parameter Object | 3+ params always together | `DateRange(start, end)` |


### åŒ…ç»“æ„é‡ç»„æŒ‡å—

#### Quick Classification Table

| Class Pattern | Target Package | Detection Keywords |
|--------------|----------------|-------------------|
| `*Utils`, `*Helper` | `util/` | static methods only, no state |
| `@interface *` | `annotation/` | annotation definition |
| `*Exception`, `*Error` | `exception/` | extends Throwable |
| `interface *` (API) | `api/` | public contract, no impl |
| `*Impl`, `*Default*` | `impl/` | implements interface |
| `*DTO`, `*VO`, `*Entity` | `model/` | data holder, getters/setters |
| `*Config`, `*Settings` | `config/` | configuration values |
| `*Event`, `*Listener` | `event/` | event system |
| `*Handler`, `*Processor` | `handler/` | handles/processes something |
| `*Factory` | `factory/` | creates objects |
| `*Builder` | `builder/` | fluent build pattern |
| `*Serializer`, `*Codec` | `serializer/` | serialize/deserialize |
| `*Validator`, `*Checker` | `validator/` | validation logic |
| `*Adapter`, `*Wrapper` | `adapter/` | adapts interface |
| `*Registry`, `*Manager` | `registry/` | manages instances |
| `*Service` | `service/` | business logic |
| `*Repository`, `*Dao` | `repository/` | data access |
| `*Controller` | `controller/` | request handling |
| `*Converter`, `*Mapper` | `converter/` | type conversion |
| `*Provider`, `*Supplier` | `provider/` | supplies instances |

#### Class Detection Rules

```java
// â†’ util/
public final class StringUtils {
    private StringUtils() {}  // private constructor
    public static String trim(String s) { ... }  // all static
}

// â†’ annotation/
@Retention(RetentionPolicy.RUNTIME)
public @interface Check { ... }

// â†’ exception/
public class ConfigException extends RuntimeException { ... }

// â†’ api/
public interface Translator { Component translate(String key); }

// â†’ impl/
public class MiniMessageTranslatorImpl implements Translator { ... }

// â†’ model/
public record UserDTO(String name, int age) {}
public class ConfigData { private String value; /* getters/setters */ }

// â†’ factory/
public class TranslatorFactory {
    public static Translator create(Type type) { ... }
}

// â†’ builder/
public class WindowBuilder {
    public WindowBuilder title(String t) { ...; return this; }
    public Window build() { ... }
}
```

#### Move Decision Flow

```
1. Is it an annotation? â†’ annotation/
2. Is it an exception? â†’ exception/
3. Is it an interface without impl? â†’ api/
4. Is it implementing an interface in api/? â†’ impl/
5. Is class name ending with Utils/Helper AND all methods static? â†’ util/
6. Is it a pure data holder (record/POJO)? â†’ model/
7. Does it create other objects? â†’ factory/
8. Does it use fluent API returning this? â†’ builder/
9. Does it validate something? â†’ validator/
10. Does it convert types? â†’ converter/
11. None of above â†’ Keep in current location
```

#### Move Execution Checklist

```bash
# Step 1: Create target directory
mkdir -p src/main/java/package/util

# Step 2: Move file
git mv OldPath.java NewPath.java

# Step 3: Update package declaration in moved file
# package old.package; â†’ package new.package;

# Step 4: Find and update all imports
grep -r "import old.package.ClassName" --include="*.java" -l

# Step 5: Verify build
./gradlew build

# Step 6: Commit
git commit -m "refactor: move ClassName to util package"
```


### æ³¨é‡Šä¼˜åŒ–è§„åˆ™ - Core Summary Only

#### Javadoc Minimalism Rules

**Class/Interface - ONE sentence only:**
```java
// âŒ Before: Verbose
/**
 * This class is responsible for translating messages using
 * the MiniMessage format. It provides various methods to
 * translate keys with placeholders and supports multiple
 * output formats including Component, String, and legacy text.
 * 
 * <p>Features:
 * <ul>
 *   <li>Placeholder support</li>
 *   <li>Multiple formats</li>
 *   <li>Caching</li>
 * </ul>
 * 
 * @author John
 * @version 1.0
 * @since 2024-01-01
 */
public class MiniMessageTranslatorImpl { ... }

// âœ… After: Core summary
/**
 * MiniMessage-based translator implementation.
 */
public class MiniMessageTranslatorImpl implements Translator { ... }
```

**Method - Verb + Object, skip obvious:**
```java
// âŒ Before
/**
 * Gets the name of the player.
 * @return the name
 */
public String getName() { return name; }

// âœ… After: No javadoc needed for simple getters
public String getName() { return name; }

// âŒ Before
/**
 * Translates the given key to a Component using the provided
 * placeholders. This method looks up the key in the message
 * source and applies MiniMessage formatting.
 * 
 * @param key the translation key to look up
 * @param placeholders the placeholders to replace
 * @return the translated Component
 */
public Component translate(String key, Object... placeholders);

// âœ… After
/**
 * Translates key to Component with placeholders.
 */
public Component translate(String key, Object... placeholders);
```

**Field - One phrase or skip:**
```java
// âŒ Before
/** The message source that provides translation strings. */
private final MessageSource source;

// âœ… After
/** Translation string source. */
private final MessageSource source;

// âœ… Or skip entirely for obvious fields
private final MessageSource source;
```

#### Comment Elimination Checklist

| Remove | Example |
|--------|---------|
| Author tags | `@author John` |
| Version tags | `@version 1.0` |
| Since tags (usually) | `@since 2024-01-01` |
| See tags (most) | `@see OtherClass` |
| Feature lists | `<ul><li>Feature 1</li>...` |
| Implementation details | "This uses HashMap internally" |
| Obvious descriptions | "Gets the name" for `getName()` |
| History/changelog | "Added in v2.0" |
| Redundant @return | `@return the name` for `getName()` |

#### Keep Only

| Keep | Reason |
|------|--------|
| Non-obvious behavior | `// Returns empty list, never null` |
| Constraints | `@param file must exist and be readable` |
| Thread safety notes | `// Not thread-safe` |
| Null handling | `@return null if not found` |
| Side effects | `// Modifies input list` |
| Why not what | `// Using LinkedList for O(1) removal` |

#### Quick Javadoc Templates

```java
// Class: ONE sentence
/** [What it is/does]. */

// Interface: ONE sentence  
/** Contract for [purpose]. */

// Method (non-trivial): Verb phrase
/** [Verb] [object] [condition/context]. */

// Exception: When thrown
/** Thrown when [condition]. */

// Constant: What it represents
/** [What this value means]. */
```

## Anti-Patterns to Fix

| Anti-Pattern | Fix |
|--------------|-----|
| `if (x) return true; else return false;` | `return x;` |
| `if (x == true)` | `if (x)` |
| `if (x == false)` | `if (!x)` |
| `str.equals("")` | `str.isEmpty()` |
| `list.size() == 0` | `list.isEmpty()` |
| `obj.toString().equals(...)` | Use proper equals |
| `catch (Exception e) { }` | Log or rethrow |
| `new Integer(x)` | `Integer.valueOf(x)` |
| `"" + number` | `String.valueOf(number)` |
| Double-checked locking wrong | Use `volatile` or holder pattern |

## Incremental Refactoring Strategy

For large codebases, refactor incrementally:

```
Week 1: Quick wins only (unused code, magic numbers, obvious duplication)
Week 2: Comment cleanup + Javadoc
Week 3: Extract utility methods within same class
Week 4: Extract utility classes
Week 5: Package reorganization
```

Each step must:
- Pass all tests
- Be a complete, working state
- Be independently revertable

## Safety Checklist

Before refactoring:
- [ ] All tests pass
- [ ] Git working tree is clean
- [ ] Feature branch created

During refactoring:
- [ ] Commit after each logical change
- [ ] Run tests after each commit
- [ ] No public API signature changes (unless requested)

After refactoring:
- [ ] All tests still pass
- [ ] No new compiler warnings
- [ ] Checkstyle passes
- [ ] Coverage not decreased

